## 项目概述
- **名称**: 多语言翻译 Agent（数据库向量检索版v2.6）
- **功能**: 读取包含中文列的CSV文件，自动识别中文列，将内容翻译成指定目标语言，生成包含原始列和翻译列的新CSV文件。支持数据库表向量RAG增强、并行处理和优化的列排列。

### 节点清单
| 节点名 | 文件位置 | 类型 | 功能描述 | 分支逻辑 | 配置文件 |
|-------|---------|------|---------|---------|---------|
| read_csv | `graphs/nodes/read_csv_node.py` | task | 读取CSV文件，识别中文列，标准化语言名称 | - | - |
| query_terminology | `graphs/nodes/query_terminology_node.py` | task | 从数据库表"翻译知识库"检索专词（支持向量检索） | - | - |
| parallel_translate_dispatch | `graphs/nodes/parallel_translate_dispatch_node.py` | looparray | 为每个目标语言启动翻译任务 | - | - |
| parallel_translate | `graphs/nodes/parallel_translate_node.py` | agent | 将中文列翻译成单个目标语言 | - | `config/translate_llm_cfg.json` |
| merge_translations | `graphs/nodes/merge_translations_node.py` | task | 合并所有语言的翻译结果 | - | - |
| generate_csv | `graphs/nodes/generate_csv_node.py` | task | 生成CSV文件并上传到对象存储 | - | - |

**类型说明**: task(task节点) / agent(大模型) / condition(条件分支) / looparray(列表循环) / loopcond(条件循环)

## 子图清单
| 子图名 | 文件位置 | 功能描述 | 被调用节点 |
|-------|---------|------|---------|-----------|
| parallel_translate_subgraph | `graphs/loop_graph.py` | 单个目标语言翻译 | parallel_translate_dispatch |

## 集成使用
- 节点 `parallel_translate` 使用集成 `大语言模型` (integration-doubao-seed)
- 节点 `generate_csv` 使用集成 `对象存储` (integration-s3-storage)
- 节点 `query_terminology` 使用集成 `数据库` (integration-postgre-database)，从表"翻译知识库"检索术语

## 数据库向量RAG说明

### 数据库表结构（v2.6）
**表名**：`翻译知识库`

**列结构**：
- `中文`（主键）：中文术语
- `中文向量`：中文术语的向量表示（用于语义检索）
- `英语`：英文翻译（可选）
- `日语`：日文翻译（可选）
- `韩语`：韩文翻译（可选）
- 其他语言列（平铺形式，可动态扩展）

**特点**：
1. **向量检索**：支持语义相似度匹配，无需完全匹配
2. **平铺设计**：每种语言一列，易于维护和查询
3. **灵活扩展**：新增语言只需添加列，无需修改代码
4. **空值兼容**：支持部分语言有翻译，部分为空
5. **回退机制**：向量检索失败时自动回退到模糊匹配

### 查询机制
- **向量相似度**：使用余弦相似度计算语义匹配度
- **批量查询**：一次查询多个术语，减少数据库访问次数
- **智能映射**：支持多种语言名称格式（英文/英语/English → 英语列）
- **自动过滤**：自动过滤空值，只返回有效的翻译
- **回退策略**：向量检索失败时自动使用模糊匹配

### 向量检索优势

| 特性 | 精确匹配 | 向量检索 |
|------|---------|---------|
| 匹配方式 | 完全匹配中文术语 | 语义相似度匹配 |
| 灵活性 | 低 | 高 |
| 适用场景 | 术语完全一致 | 术语含义相近但不完全相同 |
| 示例 | "智能手机" → "Smartphone" | "高性能智能手机" → "Smartphone" |

#### 数据库表使用规则
- 系统根据目标语言智能选择列：英文→英语列，日文→日语列，韩语→韩语列
- 向量检索会找到语义相似的术语，即使原文不完全匹配
- 如果某词在数据库中缺失翻译或向量检索失败，该词不使用数据库，由大模型直接翻译
- 扩展新语言时，只需在数据库表中添加新列，无需修改代码
- 支持空值：某些术语可能只有部分语言翻译，系统自动处理

#### 数据库表示例
| 中文 | 英语 | 日语 | 韩语 |
|------|------|------|------|
| 智能手机 | Smartphone | スマートフォン | 스마트폰 |
| 笔记本电脑 | Laptop | ノートPC | 노트북 |
| 无线耳机 | Wireless Earphones | ワイヤレスイヤホン | 무선 이어폰 |
| 蓝牙 | Bluetooth | ブルートゥース | 블루투스 |

### 新增功能（v2.6）
1. **向量检索**：使用余弦相似度进行语义匹配，支持模糊查询
2. **回退机制**：向量检索失败时自动回退到模糊匹配
3. **相似度阈值**：可配置相似度阈值（默认0.3）
4. **详细日志**：提供详细的检索日志，便于调试和优化

## 输出列名规则
翻译列的命名格式为：`原始列名_目标语言_翻译`

**示例**：
```
编号 | 商品名称 | 价格 | 商品名称_英文_翻译 | 商品名称_日文_翻译 | 分类_英文_翻译 | 分类_日文_翻译
```
