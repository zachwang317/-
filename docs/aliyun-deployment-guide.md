# é˜¿é‡Œäº‘éƒ¨ç½²æŒ‡å— - å¤šè¯­è¨€ç¿»è¯‘Agent

## ğŸ“‹ éƒ¨ç½²æ¦‚è¿°

æœ¬æŒ‡å—å°†æ•™ä½ å¦‚ä½•åœ¨**é˜¿é‡Œäº‘è½»é‡åº”ç”¨æœåŠ¡å™¨**ä¸Šéƒ¨ç½²å¤šè¯­è¨€ç¿»è¯‘Agentã€‚

**æ¨èæ–¹æ¡ˆï¼š**
- æœåŠ¡å™¨ï¼šé˜¿é‡Œäº‘è½»é‡åº”ç”¨æœåŠ¡å™¨
- éƒ¨ç½²æ–¹å¼ï¼šDocker Compose
- é¢„ä¼°æˆæœ¬ï¼šçº¦ Â¥60-100/æœˆï¼ˆå–å†³äºé…ç½®ï¼‰

---

## ğŸ›’ æ­¥éª¤1ï¼šè´­ä¹°é˜¿é‡Œäº‘æœåŠ¡å™¨

### 1.1 è®¿é—®é˜¿é‡Œäº‘è½»é‡åº”ç”¨æœåŠ¡å™¨

æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®ï¼š
```
https://www.aliyun.com/product/swas
```

### 1.2 åˆ›å»ºå®ä¾‹

1. ç‚¹å‡» **"ç«‹å³è´­ä¹°"** æˆ– **"åˆ›å»ºå®ä¾‹"**

2. **é€‰æ‹©åŒºåŸŸ**ï¼ˆæ¨èï¼‰
   - åä¸œ1ï¼ˆæ­å·ï¼‰ï¼šå»¶è¿Ÿæœ€ä½ï¼Œé€‚åˆå›½å†…ç”¨æˆ·
   - åä¸œ2ï¼ˆä¸Šæµ·ï¼‰ï¼šå¤‡é€‰
   - åå—1ï¼ˆæ·±åœ³ï¼‰ï¼šé€‚åˆåå—åœ°åŒºç”¨æˆ·

3. **é€‰æ‹©é•œåƒ**
   - æ“ä½œç³»ç»Ÿï¼šé€‰æ‹© **Ubuntu 22.04 LTS** æˆ– **Ubuntu 20.04 LTS**
   - åº”ç”¨æ¨¡æ¿ï¼šé€‰æ‹© **"ç³»ç»Ÿé•œåƒ"**

4. **é€‰æ‹©å¥—é¤**ï¼ˆæ¨èé…ç½®ï¼‰
   ```
   CPU: 2æ ¸
   å†…å­˜: 2GB æˆ– 4GB
   å­˜å‚¨: 40GB SSD
   å¸¦å®½: 3Mbpsï¼ˆå¯å‡çº§ï¼‰
   ```
   
   **ä»·æ ¼å‚è€ƒï¼š**
   - 2æ ¸2Gï¼šçº¦ Â¥60/æœˆ
   - 2æ ¸4Gï¼šçº¦ Â¥100/æœˆï¼ˆæ¨èï¼‰

5. **è´­ä¹°æ—¶é•¿**
   - é¦–æ¬¡å¯é€‰1-3ä¸ªæœˆè¯•ç”¨
   - é•¿æœŸä½¿ç”¨å»ºè®®1å¹´èµ·ï¼Œäº«å—æŠ˜æ‰£

6. **é…ç½®ç™»å½•ä¿¡æ¯**
   - ç™»å½•æ–¹å¼ï¼šé€‰æ‹© **"å¯†ç "**
   - è®¾ç½®rootå¯†ç ï¼šè®¾ç½®ä¸€ä¸ªå¼ºå¯†ç ï¼ˆåŠ¡å¿…è®°ä½ï¼ï¼‰
   - ç¤ºä¾‹ï¼š`YourP@ssw0rd!123`

7. **ç¡®è®¤è®¢å•å¹¶æ”¯ä»˜**
   - æ£€æŸ¥é…ç½®
   - ç‚¹å‡» **"ç«‹å³è´­ä¹°"**
   - å®Œæˆæ”¯ä»˜

### 1.3 è·å–æœåŠ¡å™¨ä¿¡æ¯

è´­ä¹°æˆåŠŸåï¼Œä½ ä¼šçœ‹åˆ°ï¼š
- **å…¬ç½‘IPåœ°å€**ï¼ˆå¦‚ï¼š47.xx.xx.xxï¼‰
- **ç”¨æˆ·å**ï¼šroot
- **å¯†ç **ï¼šä½ è®¾ç½®çš„å¯†ç 

**ä¿å­˜è¿™äº›ä¿¡æ¯ï¼** åç»­ç™»å½•éœ€è¦ç”¨åˆ°ã€‚

---

## ğŸ” æ­¥éª¤2ï¼šç™»å½•æœåŠ¡å™¨

### 2.1 ä½¿ç”¨SSHç™»å½•ï¼ˆMac/Linux/Windows Terminalï¼‰

```bash
ssh root@ä½ çš„æœåŠ¡å™¨IP
```

ç¤ºä¾‹ï¼š
```bash
ssh root@47.123.45.67
```

è¾“å…¥ä½ è®¾ç½®çš„å¯†ç å³å¯ç™»å½•ã€‚

### 2.2 ä½¿ç”¨SSHç™»å½•ï¼ˆWindows - Xshell/PuTTYï¼‰

**ä½¿ç”¨Xshellï¼š**
1. ä¸‹è½½å®‰è£… Xshellï¼ˆå…è´¹ç‰ˆï¼‰
2. æ‰“å¼€Xshellï¼Œç‚¹å‡» **"æ–°å»º"**
3. å¡«å†™ï¼š
   - åç§°ï¼šé˜¿é‡Œäº‘æœåŠ¡å™¨
   - ä¸»æœºï¼šä½ çš„æœåŠ¡å™¨IP
   - ç«¯å£ï¼š22
4. ç‚¹å‡» **"è¿æ¥"**
5. è¾“å…¥ç”¨æˆ·åï¼š`root`
6. è¾“å…¥å¯†ç 

### 2.3 ä½¿ç”¨é˜¿é‡Œäº‘Workbenchï¼ˆWebç»ˆç«¯ï¼‰

1. ç™»å½•é˜¿é‡Œäº‘æ§åˆ¶å°
2. è¿›å…¥ **è½»é‡åº”ç”¨æœåŠ¡å™¨**
3. ç‚¹å‡»ä½ çš„å®ä¾‹
4. ç‚¹å‡»å³ä¾§çš„ **"è¿œç¨‹è¿æ¥"** â†’ **"Workbench"**
5. è¾“å…¥ç”¨æˆ·åå’Œå¯†ç 

---

## ğŸ³ æ­¥éª¤3ï¼šå®‰è£…Dockerå’ŒDocker Compose

### 3.1 æ›´æ–°ç³»ç»Ÿ

```bash
# æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨
sudo apt update

# å‡çº§å·²å®‰è£…çš„è½¯ä»¶åŒ…
sudo apt upgrade -y
```

### 3.2 å®‰è£…Docker

```bash
# ä¸‹è½½Dockerå®‰è£…è„šæœ¬
curl -fsSL https://get.docker.com -o get-docker.sh

# è¿è¡Œå®‰è£…è„šæœ¬
sudo sh get-docker.sh

# å¯åŠ¨DockeræœåŠ¡
sudo systemctl start docker

# è®¾ç½®Dockerå¼€æœºè‡ªå¯
sudo systemctl enable docker

# éªŒè¯Dockerå®‰è£…
docker --version
```

å¦‚æœæˆåŠŸï¼Œä¼šæ˜¾ç¤ºï¼š`Docker version 24.x.x`

### 3.3 å®‰è£…Docker Compose

```bash
# ä¸‹è½½Docker Compose
sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose

# æ·»åŠ æ‰§è¡Œæƒé™
sudo chmod +x /usr/local/bin/docker-compose

# éªŒè¯Docker Composeå®‰è£…
docker-compose --version
```

å¦‚æœæˆåŠŸï¼Œä¼šæ˜¾ç¤ºï¼š`Docker Compose version v2.x.x`

---

## ğŸ“¦ æ­¥éª¤4ï¼šå®‰è£…Gitå¹¶å…‹éš†é¡¹ç›®

### 4.1 å®‰è£…Git

```bash
sudo apt install git -y
```

### 4.2 å…‹éš†é¡¹ç›®

```bash
# å…‹éš†é¡¹ç›®åˆ°æœåŠ¡å™¨
cd /opt
git clone https://github.com/zachwang317/-..git translation

# è¿›å…¥é¡¹ç›®ç›®å½•
cd translation
```

å¦‚æœé‡åˆ°SSHæƒé™é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨HTTPSæ–¹å¼ï¼š
```bash
git clone https://github.com/zachwang317/-.git translation
```

---

## ğŸ”§ æ­¥éª¤5ï¼šé…ç½®ç¯å¢ƒå˜é‡

### 5.1 åˆ›å»º.envæ–‡ä»¶

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp .env.example .env

# ç¼–è¾‘ç¯å¢ƒå˜é‡
nano .env
```

### 5.2 é…ç½®æ•°æ®åº“è¿æ¥

åœ¨ `.env` æ–‡ä»¶ä¸­ï¼Œä¿®æ”¹ä»¥ä¸‹å†…å®¹ï¼š

```env
# æ•°æ®åº“è¿æ¥ï¼ˆä½¿ç”¨docker-composeè‡ªå¸¦çš„PostgreSQLï¼‰
PGDATABASE_URL=postgresql://postgres:ä½ çš„å¯†ç @postgres:5432/translation_db

# æ•°æ®åº“å¯†ç ï¼ˆä¿®æ”¹ä¸ºä½ çš„å¯†ç ï¼‰
POSTGRES_PASSWORD=ä½ çš„å¯†ç 
POSTGRES_DB=translation_db

# å¯¹è±¡å­˜å‚¨é…ç½®ï¼ˆå¯é€‰ï¼‰
# å¦‚æœä¸éœ€è¦ä¸Šä¼ åˆ°å¯¹è±¡å­˜å‚¨ï¼Œå¯ä»¥ç•™ç©º
S3_ACCESS_KEY_ID=
S3_SECRET_ACCESS_KEY=
S3_BUCKET_NAME=
S3_ENDPOINT=

# Pythonç¯å¢ƒ
PYTHONPATH=/app
COZE_PROJECT_ENV=PROD
```

**é‡è¦ï¼š**
- ä¿®æ”¹ `POSTGRES_PASSWORD` ä¸ºä½ çš„å¼ºå¯†ç 
- ä¿®æ”¹ `PGDATABASE_URL` ä¸­çš„å¯†ç ä¸ `POSTGRES_PASSWORD` ä¿æŒä¸€è‡´

**ä¿å­˜æ–‡ä»¶ï¼š**
- æŒ‰ `Ctrl + O` ä¿å­˜
- æŒ‰ `Enter` ç¡®è®¤
- æŒ‰ `Ctrl + X` é€€å‡º

---

## ğŸš€ æ­¥éª¤6ï¼šå¯åŠ¨æœåŠ¡

### 6.1 åˆ›å»ºå¿…è¦çš„ç›®å½•

```bash
# åˆ›å»ºæ•°æ®ç›®å½•
mkdir -p assets logs

# è®¾ç½®æƒé™
chmod -R 755 assets logs
```

### 6.2 å¯åŠ¨Docker Compose

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼ˆåå°è¿è¡Œï¼‰
docker-compose up -d
```

### 6.3 æŸ¥çœ‹æœåŠ¡çŠ¶æ€

```bash
# æŸ¥çœ‹æ‰€æœ‰å®¹å™¨çŠ¶æ€
docker-compose ps
```

ä½ åº”è¯¥çœ‹åˆ°ä¸¤ä¸ªå®¹å™¨ï¼š
```
NAME                      STATUS
translation-app           Up
translation-db            Up
```

### 6.4 æŸ¥çœ‹æ—¥å¿—

```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
docker-compose logs -f translation-app

# æŸ¥çœ‹æ•°æ®åº“æ—¥å¿—
docker-compose logs -f translation-db
```

æŒ‰ `Ctrl + C` é€€å‡ºæ—¥å¿—æŸ¥çœ‹ã€‚

---

## ğŸŒ æ­¥éª¤7ï¼šè®¿é—®åº”ç”¨

### 7.1 é…ç½®é˜²ç«å¢™

é˜¿é‡Œäº‘æœåŠ¡å™¨é»˜è®¤åªå¼€æ”¾80å’Œ443ç«¯å£ï¼Œæˆ‘ä»¬éœ€è¦å¼€æ”¾5000ç«¯å£ã€‚

1. ç™»å½•é˜¿é‡Œäº‘æ§åˆ¶å°
2. è¿›å…¥ **è½»é‡åº”ç”¨æœåŠ¡å™¨**
3. ç‚¹å‡»ä½ çš„å®ä¾‹
4. æ‰¾åˆ° **"é˜²ç«å¢™"** é€‰é¡¹å¡
5. ç‚¹å‡» **"æ·»åŠ è§„åˆ™"**
6. æ·»åŠ è§„åˆ™ï¼š
   - åè®®ï¼šTCP
   - ç«¯å£ï¼š5000
   - é™åˆ¶ï¼šå…è®¸æ‰€æœ‰IPï¼ˆ0.0.0.0/0ï¼‰
7. ç‚¹å‡» **"ç¡®å®š"**

### 7.2 è®¿é—®å‰ç«¯é¡µé¢

åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼š
```
http://ä½ çš„æœåŠ¡å™¨IP:5000
```

ç¤ºä¾‹ï¼š
```
http://47.123.45.67:5000
```

å¦‚æœçœ‹åˆ°ç¿»è¯‘ç•Œé¢ï¼Œæ­å–œä½ éƒ¨ç½²æˆåŠŸï¼ğŸ‰

---

## ğŸ” æ­¥éª¤8ï¼šé…ç½®åŸŸåï¼ˆå¯é€‰ï¼‰

å¦‚æœä½ æœ‰åŸŸåï¼Œå¯ä»¥é…ç½®è®¿é—®ã€‚

### 8.1 è§£æåŸŸå

1. ç™»å½•ä½ çš„åŸŸåæœåŠ¡å•†ï¼ˆé˜¿é‡Œäº‘ã€è…¾è®¯äº‘ç­‰ï¼‰
2. è¿›å…¥åŸŸåè§£æç®¡ç†
3. æ·»åŠ Aè®°å½•ï¼š
   - ä¸»æœºè®°å½•ï¼š`www` æˆ– `@`
   - è®°å½•å€¼ï¼šä½ çš„æœåŠ¡å™¨IP
   - TTLï¼š600
4. ä¿å­˜

### 8.2 ä¿®æ”¹ç«¯å£æ˜ å°„ï¼ˆå¯é€‰ï¼‰

å¦‚æœä¸æƒ³åœ¨URLä¸­æ˜¾ç¤ºç«¯å£å·ï¼Œå¯ä»¥ä¿®æ”¹Dockerç«¯å£æ˜ å°„ï¼š

ç¼–è¾‘ `docker-compose.yml`ï¼š

```yaml
services:
  translation-app:
    ports:
      - "80:5000"  # å°†80ç«¯å£æ˜ å°„åˆ°å®¹å™¨çš„5000ç«¯å£
```

é‡å¯æœåŠ¡ï¼š
```bash
docker-compose down
docker-compose up -d
```

ç°åœ¨å¯ä»¥é€šè¿‡ `http://ä½ çš„åŸŸå` è®¿é—®ã€‚

---

## ğŸ›¡ï¸ æ­¥éª¤9ï¼šé…ç½®SSLè¯ä¹¦ï¼ˆå¯é€‰ï¼‰

ä½¿ç”¨Let's Encryptå…è´¹SSLè¯ä¹¦ã€‚

### 9.1 å®‰è£…Certbot

```bash
sudo apt install certbot python3-certbot-nginx -y
```

### 9.2 è·å–è¯ä¹¦

```bash
# è·å–è¯ä¹¦ï¼ˆéœ€è¦å…ˆé…ç½®åŸŸåè§£æï¼‰
sudo certbot certonly --nginx -d ä½ çš„åŸŸå
```

æŒ‰ç…§æç¤ºæ“ä½œï¼Œè¯ä¹¦ä¼šä¿å­˜åœ¨ `/etc/letsencrypt/live/ä½ çš„åŸŸå/`ã€‚

### 9.3 é…ç½®Nginxåå‘ä»£ç†

```bash
# å®‰è£…Nginx
sudo apt install nginx -y

# åˆ›å»ºNginxé…ç½®æ–‡ä»¶
sudo nano /etc/nginx/sites-available/translation
```

æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š

```nginx
server {
    listen 80;
    server_name ä½ çš„åŸŸå;

    location / {
        proxy_pass http://localhost:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

å¯ç”¨é…ç½®ï¼š
```bash
sudo ln -s /etc/nginx/sites-available/translation /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl restart nginx
```

è·å–SSLè¯ä¹¦å¹¶é…ç½®HTTPSï¼š
```bash
sudo certbot --nginx -d ä½ çš„åŸŸå
```

ç°åœ¨å¯ä»¥é€šè¿‡ `https://ä½ çš„åŸŸå` å®‰å…¨è®¿é—®ã€‚

---

## ğŸ“Š æ­¥éª¤10ï¼šç®¡ç†æœåŠ¡

### 10.1 å¸¸ç”¨ç®¡ç†å‘½ä»¤

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# åœæ­¢æœåŠ¡
docker-compose stop

# å¯åŠ¨æœåŠ¡
docker-compose start

# é‡å¯æœåŠ¡
docker-compose restart

# åœæ­¢å¹¶åˆ é™¤å®¹å™¨
docker-compose down

# é‡æ–°æ„å»ºå¹¶å¯åŠ¨
docker-compose up -d --build
```

### 10.2 å¤‡ä»½æ•°æ®åº“

```bash
# å¤‡ä»½æ•°æ®åº“
docker exec translation-db pg_dump -U postgres translation_db > backup_$(date +%Y%m%d).sql

# æ¢å¤æ•°æ®åº“
docker exec -i translation-db psql -U postgres translation_db < backup_20240101.sql
```

### 10.3 æ›´æ–°é¡¹ç›®

```bash
cd /opt/translation

# æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# é‡æ–°æ„å»ºå¹¶å¯åŠ¨
docker-compose up -d --build
```

---

## ğŸ” æ­¥éª¤11ï¼šç›‘æ§å’Œæ—¥å¿—

### 11.1 æŸ¥çœ‹åº”ç”¨æ—¥å¿—

```bash
# æŸ¥çœ‹å®æ—¶æ—¥å¿—
docker-compose logs -f translation-app

# æŸ¥çœ‹æœ€è¿‘100è¡Œæ—¥å¿—
docker-compose logs --tail=100 translation-app
```

### 11.2 æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨

```bash
# æŸ¥çœ‹å®¹å™¨èµ„æºå ç”¨
docker stats
```

### 11.3 æŸ¥çœ‹ç£ç›˜ç©ºé—´

```bash
# æŸ¥çœ‹ç£ç›˜ä½¿ç”¨
df -h

# æ¸…ç†Dockeræœªä½¿ç”¨çš„èµ„æº
docker system prune -a
```

---

## âš ï¸ å¸¸è§é—®é¢˜

### é—®é¢˜1ï¼šæ— æ³•è®¿é—®5000ç«¯å£

**è§£å†³æ–¹æ³•ï¼š**
1. æ£€æŸ¥é˜²ç«å¢™è§„åˆ™æ˜¯å¦æ·»åŠ 
2. æ£€æŸ¥Dockerå®¹å™¨æ˜¯å¦æ­£å¸¸è¿è¡Œï¼š`docker-compose ps`
3. æ£€æŸ¥åº”ç”¨æ—¥å¿—ï¼š`docker-compose logs translation-app`

### é—®é¢˜2ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥

**è§£å†³æ–¹æ³•ï¼š**
1. æ£€æŸ¥ `.env` æ–‡ä»¶ä¸­çš„ `PGDATABASE_URL` æ˜¯å¦æ­£ç¡®
2. ç¡®ä¿å¯†ç ä¸ `POSTGRES_PASSWORD` ä¸€è‡´
3. é‡å¯æœåŠ¡ï¼š`docker-compose restart`

### é—®é¢˜3ï¼šå†…å­˜ä¸è¶³

**è§£å†³æ–¹æ³•ï¼š**
1. å‡çº§æœåŠ¡å™¨é…ç½®ï¼ˆæ¨è4GBå†…å­˜ï¼‰
2. é™åˆ¶Dockerèµ„æºä½¿ç”¨ï¼š
   ```yaml
   services:
     translation-app:
       deploy:
         resources:
           limits:
             memory: 1G
   ```

### é—®é¢˜4ï¼šç¿»è¯‘é€Ÿåº¦æ…¢

**è§£å†³æ–¹æ³•ï¼š**
1. å‡çº§æœåŠ¡å™¨å¸¦å®½ï¼ˆå»ºè®®5Mbps+ï¼‰
2. æ£€æŸ¥è±†åŒ…APIç½‘ç»œå»¶è¿Ÿ
3. ä¼˜åŒ–æ‰¹æ¬¡å¤§å°

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. **æŸ¥çœ‹æ—¥å¿—**ï¼š`docker-compose logs -f`
2. **æŸ¥çœ‹æ–‡æ¡£**ï¼šé¡¹ç›® `docs/` ç›®å½•
3. **GitHub Issues**ï¼šhttps://github.com/zachwang317/-/issues

---

## ğŸ‰ éƒ¨ç½²å®Œæˆï¼

æ­å–œä½ æˆåŠŸåœ¨é˜¿é‡Œäº‘ä¸Šéƒ¨ç½²äº†å¤šè¯­è¨€ç¿»è¯‘Agentï¼

**è®¿é—®åœ°å€ï¼š**
```
http://ä½ çš„æœåŠ¡å™¨IP:5000
```

**åç»­ç»´æŠ¤ï¼š**
- å®šæœŸå¤‡ä»½æ•°æ®åº“
- ç›‘æ§æœåŠ¡å™¨èµ„æº
- åŠæ—¶æ›´æ–°é¡¹ç›®ä»£ç 

---

## ğŸ“š æˆæœ¬å‚è€ƒ

| é…ç½® | æœˆè´¹ | å¹´è´¹ |
|-----|------|------|
| 2æ ¸2G | Â¥60 | Â¥576 |
| 2æ ¸4Gï¼ˆæ¨èï¼‰ | Â¥100 | Â¥960 |
| 4æ ¸8G | Â¥200 | Â¥1920 |

**çœé’±æŠ€å·§ï¼š**
- é¦–æ¬¡è´­ä¹°æœ‰ä¼˜æƒ 
- åŒ…å¹´äº«å—8-9æŠ˜
- å­¦ç”Ÿå¯ç”³è¯·å­¦ç”Ÿä¼˜æƒ 

---

**ç¥ä½¿ç”¨æ„‰å¿«ï¼** ğŸš€
