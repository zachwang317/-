# å¤šè¯­è¨€ç¿»è¯‘Agent - ä¼˜ç‚¹ä¸æ”¹è¿›å»ºè®®

## âœ… å½“å‰ç‰ˆæœ¬çš„ä¼˜ç‚¹

### 1. ğŸš€ æ€§èƒ½ä¼˜åŒ–ä¼˜ç§€
**æ‰¹é‡æ£€ç´¢ä¼˜åŒ–**
- çŸ¥è¯†åº“æŸ¥è¯¢é‡‡ç”¨æ‰¹é‡ç­–ç•¥ï¼ˆæ¯æ‰¹10ä¸ªè¯ï¼‰
- ç½‘ç»œè¯·æ±‚æ¬¡æ•°å‡å°‘çº¦90%
- æŸ¥è¯¢æ—¶é—´ç¼©çŸ­80-90%

**å¹¶è¡Œå¤„ç†**
- æŒ‰ç›®æ ‡è¯­è¨€å¹¶è¡Œç¿»è¯‘
- å¤šç›®æ ‡è¯­è¨€åœºæ™¯ä¸‹æ•ˆç‡æ˜¾è‘—æå‡

**æ™ºèƒ½å»é‡**
- è‡ªåŠ¨å»é™¤é‡å¤è¯æ±‡
- é¿å…é‡å¤è®¡ç®—

### 2. ğŸ¯ åŠŸèƒ½å®Œæ•´æ€§é«˜
**å…¨æµç¨‹è‡ªåŠ¨åŒ–**
- CSVè¯»å– â†’ è¯†åˆ«ä¸­æ–‡åˆ— â†’ çŸ¥è¯†åº“æ£€ç´¢ â†’ ç¿»è¯‘ â†’ ç”ŸæˆCSV
- æ— éœ€äººå·¥å¹²é¢„

**è¯­è¨€æ”¯æŒå¹¿æ³›**
- æ”¯æŒ8ç§ä¸»è¦è¯­è¨€ï¼ˆè‹±æ–‡ã€æ—¥æ–‡ã€éŸ©æ–‡ã€æ³•æ–‡ã€å¾·æ–‡ã€è¥¿ç­ç‰™æ–‡ã€ä¿„æ–‡ã€æ„å¤§åˆ©æ–‡ï¼‰
- æ˜“äºæ‰©å±•æ–°è¯­è¨€

**è¾“å…¥æ ¼å¼å‹å¥½**
- æ”¯æŒå¤šç§è¯­è¨€åç§°å†™æ³•ï¼ˆè‹±æ–‡/è‹±è¯­/Englishï¼‰
- ç®€å•çš„é¡¿å·åˆ†éš”æ ¼å¼

### 3. ğŸ§  æ™ºèƒ½åŒ–ç¨‹åº¦é«˜
**çŸ¥è¯†åº“RAGå¢å¼º**
- è‡ªåŠ¨ä»çŸ¥è¯†åº“æ£€ç´¢ä¸“è¯
- æå‡ç¿»è¯‘å‡†ç¡®ç‡

**æ™ºèƒ½åˆ—è¯†åˆ«**
- æ ¹æ®ç›®æ ‡è¯­è¨€è‡ªåŠ¨é€‰æ‹©çŸ¥è¯†åº“åˆ—
- æ— éœ€æ‰‹åŠ¨é…ç½®

**è‡ªåŠ¨ä¸­æ–‡åˆ—è¯†åˆ«**
- æ­£åˆ™è¡¨è¾¾å¼è¯†åˆ«ä¸­æ–‡å†…å®¹
- æ— éœ€æ‰‹åŠ¨æŒ‡å®š

### 4. ğŸ›¡ï¸ å®¹é”™æ€§å¼º
**çŸ¥è¯†åº“å¤±è´¥ä¸å½±å“ä¸»æµç¨‹**
- çŸ¥è¯†åº“æŸ¥è¯¢å¤±è´¥æ—¶è¿”å›ç©ºå­—å…¸
- åç»­ç»§ç»­ç”¨å¤§æ¨¡å‹ç¿»è¯‘

**ç©ºå€¼å…¼å®¹**
- çŸ¥è¯†åº“ç¼ºå¤±ç¿»è¯‘æ—¶è‡ªåŠ¨å¤„ç†
- ä¸å½±å“æ•´ä½“æµç¨‹

**æ ‡å‡†åŒ–å¤„ç†**
- è‡ªåŠ¨æ ‡å‡†åŒ–è¯­è¨€åç§°
- é¿å…ç”¨æˆ·è¾“å…¥é”™è¯¯

### 5. ğŸ”§ ä»£ç è´¨é‡é«˜
**ç»“æ„æ¸…æ™°**
- æ¨¡å—åŒ–è®¾è®¡ï¼Œæ¯ä¸ªèŠ‚ç‚¹ç‹¬ç«‹
- æ˜“äºç†è§£å’Œç»´æŠ¤

**ç±»å‹å®‰å…¨**
- ä½¿ç”¨Pydanticè¿›è¡Œç±»å‹å®šä¹‰
- å‡å°‘è¿è¡Œæ—¶é”™è¯¯

**æ–‡æ¡£å®Œå–„**
- è¯¦ç»†çš„èŠ‚ç‚¹æ³¨é‡Š
- å®Œæ•´çš„æ–‡æ¡£è¯´æ˜

### 6. ğŸ“¦ æ‰©å±•æ€§å¥½
**æ˜“äºæ·»åŠ æ–°è¯­è¨€**
- åªéœ€æ·»åŠ æ˜ å°„è¡¨å³å¯
- æ— éœ€ä¿®æ”¹ä¸šåŠ¡ä»£ç 

**æ˜“äºæ·»åŠ æ–°åŠŸèƒ½**
- èŠ‚ç‚¹ç‹¬ç«‹ï¼Œäº’ä¸å½±å“
- å¯ä»¥çµæ´»ç»„åˆ

### 7. ğŸ’¾ æ•°æ®ç®¡ç†è§„èŒƒ
**å¯¹è±¡å­˜å‚¨é›†æˆ**
- è‡ªåŠ¨ä¸Šä¼ CSVåˆ°å¯¹è±¡å­˜å‚¨
- ç”Ÿæˆä¸´æ—¶è®¿é—®URL

**ç¼–ç è§„èŒƒ**
- ä½¿ç”¨UTF-8-BOMç¼–ç 
- å…¼å®¹Excelæ‰“å¼€

---

## ğŸ”§ å¯ä»¥æ”¹è¿›çš„åœ°æ–¹

### 1. ğŸ“Š å¤§æ•°æ®é‡åœºæ™¯ä¼˜åŒ–

#### é—®é¢˜
- è¶…å¤§CSVæ–‡ä»¶ï¼ˆ>10000è¡Œï¼‰å¯èƒ½å¯¼è‡´å†…å­˜ä¸è¶³
- ç¼ºå°‘è¿›åº¦åé¦ˆï¼Œç”¨æˆ·ä¸çŸ¥é“å¤„ç†è¿›åº¦
- å¤±è´¥åæ— æ³•æ–­ç‚¹ç»­ä¼ 

#### æ”¹è¿›å»ºè®®
**åˆ†æ‰¹å¤„ç†**
```python
# æ¯æ¬¡å¤„ç†1000è¡Œï¼Œé¿å…å†…å­˜æº¢å‡º
batch_size = 1000
for i in range(0, total_rows, batch_size):
    batch = rows[i:i + batch_size]
    process_batch(batch)
    save_progress(i)  # ä¿å­˜è¿›åº¦
```

**è¿›åº¦åé¦ˆ**
```python
# åœ¨èŠ‚ç‚¹ä¸­æ·»åŠ è¿›åº¦è¾“å‡º
class ProcessNodeOutput(BaseModel):
    progress: float = Field(..., description="å¤„ç†è¿›åº¦ 0-1")
    processed_count: int = Field(..., description="å·²å¤„ç†è¡Œæ•°")
```

**æ–­ç‚¹ç»­ä¼ **
```python
# ä¿å­˜ä¸­é—´ç»“æœåˆ°ä¸´æ—¶æ–‡ä»¶
checkpoint_file = f"/tmp/translation_checkpoint_{timestamp}.json"
# å¤±è´¥æ—¶ä»æ–­ç‚¹æ¢å¤
if os.path.exists(checkpoint_file):
    resume_from_checkpoint()
```

### 2. ğŸ¨ ç”¨æˆ·ä½“éªŒä¼˜åŒ–

#### é—®é¢˜
- åˆ—åè¾ƒé•¿ï¼ˆå¦‚`å•†å“åç§°_ç›®æ ‡è¯­è¨€_ç¿»è¯‘`ï¼‰
- ç¼ºå°‘ç»“æœé¢„è§ˆ
- æ— æ³•ç¡®è®¤ç¿»è¯‘è´¨é‡

#### æ”¹è¿›å»ºè®®
**åˆ—åå¯é…ç½®**
```python
# æ”¯æŒè‡ªå®šä¹‰åˆ—åæ ¼å¼
class GraphInput(BaseModel):
    column_name_format: str = Field(
        default="{column}_{lang}_ç¿»è¯‘",
        description="åˆ—åæ ¼å¼ï¼Œæ”¯æŒ{column}å’Œ{lang}å ä½ç¬¦"
    )
```

**ç»“æœé¢„è§ˆ**
```python
# ç”Ÿæˆå‰å‡ è¡Œçš„é¢„è§ˆ
def preview_translation(original_data, translated_sample):
    preview = original_data[:5].merge(translated_sample[:5])
    return preview
```

**è´¨é‡æ£€æŸ¥**
```python
# æ·»åŠ è´¨é‡æ£€æŸ¥èŠ‚ç‚¹
def quality_check(translated_data, original_data):
    # æ£€æŸ¥ç©ºå€¼ã€é•¿åº¦å¼‚å¸¸ç­‰
    issues = []
    for row in translated_data:
        if not row['ç¿»è¯‘ç»“æœ']:
            issues.append(f"ç¬¬{row['ç´¢å¼•']}è¡Œç¿»è¯‘ä¸ºç©º")
    return issues
```

### 3. ğŸ”„ é”™è¯¯å¤„ç†å¢å¼º

#### é—®é¢˜
- é”™è¯¯ä¿¡æ¯ä¸å¤Ÿè¯¦ç»†
- ç¼ºå°‘é‡è¯•æœºåˆ¶
- æ²¡æœ‰é”™è¯¯æ—¥å¿—è®°å½•

#### æ”¹è¿›å»ºè®®
**è¯¦ç»†é”™è¯¯ä¿¡æ¯**
```python
class TranslationError(BaseModel):
    error_code: str = Field(..., description="é”™è¯¯ä»£ç ")
    error_message: str = Field(..., description="é”™è¯¯æè¿°")
    error_detail: str = Field(default="", description="é”™è¯¯è¯¦æƒ…")
    suggestion: str = Field(default="", description="å¤„ç†å»ºè®®")
```

**è‡ªåŠ¨é‡è¯•**
```python
from tenacity import retry, stop_after_attempt, wait_exponential

@retry(stop=stop_after_attempt(3), wait=wait_exponential(multiplier=1, min=4, max=10))
def call_llm_with_retry(messages):
    return llm_client.invoke(messages)
```

**é”™è¯¯æ—¥å¿—**
```python
import logging

logger = logging.getLogger(__name__)

def translate_node(state):
    try:
        # ç¿»è¯‘é€»è¾‘
    except Exception as e:
        logger.error(f"ç¿»è¯‘å¤±è´¥: {str(e)}", exc_info=True)
        # ä¿å­˜é”™è¯¯ä¿¡æ¯åˆ°çŠ¶æ€
        raise
```

### 4. ğŸ’¾ ç¼“å­˜æœºåˆ¶ä¼˜åŒ–

#### é—®é¢˜
- ç›¸åŒå†…å®¹é‡å¤ç¿»è¯‘
- çŸ¥è¯†åº“é‡å¤æŸ¥è¯¢
- æ— å†å²è®°å½•

#### æ”¹è¿›å»ºè®®
**ç¿»è¯‘ç¼“å­˜**
```python
from functools import lru_cache

@lru_cache(maxsize=1000)
def cached_translate(text, target_lang):
    # æ£€æŸ¥ç¼“å­˜
    cache_key = f"{text}_{target_lang}"
    if cache_key in translation_cache:
        return translation_cache[cache_key]
    # è°ƒç”¨å¤§æ¨¡å‹
    result = llm.translate(text, target_lang)
    translation_cache[cache_key] = result
    return result
```

**çŸ¥è¯†åº“ç¼“å­˜**
```python
# ç¼“å­˜çŸ¥è¯†åº“æŸ¥è¯¢ç»“æœ
kb_cache = {}

def query_knowledge_base(words):
    cache_key = tuple(sorted(words))
    if cache_key in kb_cache:
        return kb_cache[cache_key]
    # æŸ¥è¯¢çŸ¥è¯†åº“
    result = kb_client.search(query)
    kb_cache[cache_key] = result
    return result
```

### 5. ğŸ” æ•°æ®éªŒè¯å¢å¼º

#### é—®é¢˜
- ç¼ºå°‘è¾“å…¥æ•°æ®éªŒè¯
- æ²¡æœ‰æ•°æ®è´¨é‡æ£€æŸ¥
- å¼‚å¸¸æ•°æ®å¯èƒ½å¯¼è‡´é”™è¯¯

#### æ”¹è¿›å»ºè®®
**è¾“å…¥éªŒè¯**
```python
def validate_input(csv_file, target_languages):
    # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
    # æ£€æŸ¥æ–‡ä»¶æ ¼å¼æ˜¯å¦ä¸ºCSV
    # æ£€æŸ¥ç›®æ ‡è¯­è¨€æ˜¯å¦æœ‰æ•ˆ
    # æ£€æŸ¥æ–‡ä»¶å¤§å°æ˜¯å¦è¶…é™
    return ValidationResult(is_valid=True, errors=[])
```

**æ•°æ®è´¨é‡æ£€æŸ¥**
```python
def check_data_quality(data):
    issues = []
    # æ£€æŸ¥ç©ºå€¼
    # æ£€æŸ¥æ•°æ®ç±»å‹
    # æ£€æŸ¥ç‰¹æ®Šå­—ç¬¦
    # æ£€æŸ¥ç¼–ç é—®é¢˜
    return issues
```

### 6. ğŸ¯ ç¿»è¯‘è´¨é‡æå‡

#### é—®é¢˜
- ä¸Šä¸‹æ–‡è¿è´¯æ€§å¯èƒ½ä¸è¶³
- ä¸“ä¸šæœ¯è¯­ç¿»è¯‘å¯èƒ½ä¸å‡†
- ç¼ºå°‘ç¿»è¯‘ä¸€è‡´æ€§æ£€æŸ¥

#### æ”¹è¿›å»ºè®®
**ä¸Šä¸‹æ–‡å¢å¼º**
```python
# ä¸ºæ¯è¡Œç¿»è¯‘æä¾›ä¸Šä¸‹æ–‡
def translate_with_context(row, previous_rows):
    context = "\n".join([
        "å‰å‡ è¡Œç¿»è¯‘ï¼š",
        *[f"{r['åŸæ–‡']}: {r['ç¿»è¯‘']}" for r in previous_rows[-3:]]
    ])
    return llm.translate(row['åŸæ–‡'], context=context)
```

**æœ¯è¯­ä¸€è‡´æ€§**
```python
# ç¡®ä¿åŒä¸€æœ¯è¯­ç¿»è¯‘ä¸€è‡´
def ensure_consistency(translated_data, terminology_dict):
    for row in translated_data:
        for term in terminology_dict:
            if term in row['åŸæ–‡']:
                # ä½¿ç”¨çŸ¥è¯†åº“ä¸­çš„ç¿»è¯‘
                row['ç¿»è¯‘'] = row['ç¿»è¯‘'].replace(term, terminology_dict[term])
```

### 7. ğŸ“ˆ å¯è§‚æµ‹æ€§å¢å¼º

#### é—®é¢˜
- ç¼ºå°‘æ€§èƒ½æŒ‡æ ‡
- æ— æ³•è¿½è¸ªç¿»è¯‘è´¨é‡
- æ²¡æœ‰ä½¿ç”¨ç»Ÿè®¡

#### æ”¹è¿›å»ºè®®
**æ€§èƒ½æŒ‡æ ‡**
```python
class Metrics(BaseModel):
    total_rows: int = Field(..., description="æ€»è¡Œæ•°")
    processed_rows: int = Field(..., description="å·²å¤„ç†è¡Œæ•°")
    success_rate: float = Field(..., description="æˆåŠŸç‡")
    avg_time_per_row: float = Field(..., description="å¹³å‡æ¯è¡Œè€—æ—¶")
```

**ç¿»è¯‘è´¨é‡æŒ‡æ ‡**
```python
def calculate_quality_metrics(translated_data):
    return {
        "translation_confidence": calculate_confidence(),
        "terminology_usage_rate": calculate_terminology_usage(),
        "empty_translation_count": count_empty_translations()
    }
```

### 8. âš™ï¸ é…ç½®çµæ´»æ€§

#### é—®é¢˜
- åˆ—åæ ¼å¼å›ºå®š
- æ— æ³•è‡ªå®šä¹‰ç¿»è¯‘ç­–ç•¥
- ç¼ºå°‘é«˜çº§é…ç½®é€‰é¡¹

#### æ”¹è¿›å»ºè®®
**çµæ´»é…ç½®**
```python
class TranslationConfig(BaseModel):
    model: str = Field(default="doubao-seed-1-8-251228")
    temperature: float = Field(default=0.3)
    batch_size: int = Field(default=50)
    enable_terminology_kb: bool = Field(default=True)
    enable_cache: bool = Field(default=True)
    quality_threshold: float = Field(default=0.7)
```

### 9. ğŸŒ å¤šè¯­è¨€æ”¯æŒæ‰©å±•

#### é—®é¢˜
- åªæ”¯æŒå•å‘ç¿»è¯‘ï¼ˆä¸­æ–‡â†’å…¶ä»–ï¼‰
- ä¸æ”¯æŒå…¶ä»–è¯­è¨€äº’è¯‘
- ä¸æ”¯æŒæ··åˆè¯­è¨€

#### æ”¹è¿›å»ºè®®
**è¯­è¨€æ£€æµ‹**
```python
from langdetect import detect

def detect_language(text):
    return detect(text)

def auto_translate(row, target_langs):
    source_lang = detect_language(row['åŸæ–‡'])
    for target in target_langs:
        if source_lang != target:
            row[f'{target}_ç¿»è¯‘'] = translate(row['åŸæ–‡'], source_lang, target)
```

### 10. ğŸ“¤ è¾“å‡ºæ ¼å¼å¢å¼º

#### é—®é¢˜
- åªæ”¯æŒCSVè¾“å‡º
- ä¸æ”¯æŒå…¶ä»–æ ¼å¼
- ç¼ºå°‘æ ¼å¼åŒ–é€‰é¡¹

#### æ”¹è¿›å»ºè®®
**å¤šæ ¼å¼è¾“å‡º**
```python
class OutputFormat(BaseModel):
    format_type: Literal["csv", "excel", "json", "html"]
    encoding: str = "utf-8-sig"
    include_original: bool = True
    include_timestamp: bool = False

def export_data(data, output_format):
    if output_format.format_type == "excel":
        return export_to_excel(data)
    elif output_format.format_type == "json":
        return export_to_json(data)
    # ...
```

---

## ğŸ¯ ä¼˜å…ˆçº§å»ºè®®

### é«˜ä¼˜å…ˆçº§ï¼ˆå»ºè®®ç«‹å³ä¼˜åŒ–ï¼‰
1. **é”™è¯¯å¤„ç†å¢å¼º** - æå‡ç¨³å®šæ€§
2. **è¿›åº¦åé¦ˆ** - æ”¹å–„ç”¨æˆ·ä½“éªŒ
3. **æ•°æ®éªŒè¯** - å‡å°‘é”™è¯¯

### ä¸­ä¼˜å…ˆçº§ï¼ˆè¿‘æœŸä¼˜åŒ–ï¼‰
4. **ç¼“å­˜æœºåˆ¶** - æå‡æ€§èƒ½
5. **å¯è§‚æµ‹æ€§** - ä¾¿äºç›‘æ§
6. **é…ç½®çµæ´»æ€§** - æå‡å¯ç”¨æ€§

### ä½ä¼˜å…ˆçº§ï¼ˆé•¿æœŸä¼˜åŒ–ï¼‰
7. **å¤§æ•°æ®é‡ä¼˜åŒ–** - å¤„ç†ç‰¹æ®Šåœºæ™¯
8. **ç¿»è¯‘è´¨é‡æå‡** - æŒç»­æ”¹è¿›
9. **å¤šè¯­è¨€æ‰©å±•** - å¢åŠ åŠŸèƒ½
10. **è¾“å‡ºæ ¼å¼å¢å¼º** - ä¸°å¯ŒåŠŸèƒ½

---

## ğŸ’¡ æ€»ç»“

### å½“å‰ç‰ˆæœ¬çš„æ ¸å¿ƒä¼˜åŠ¿
- **æ€§èƒ½ä¼˜ç§€**ï¼šæ‰¹é‡æ£€ç´¢ + å¹¶è¡Œå¤„ç†
- **åŠŸèƒ½å®Œæ•´**ï¼šå…¨æµç¨‹è‡ªåŠ¨åŒ–
- **æ™ºèƒ½åŒ–**ï¼šçŸ¥è¯†åº“RAG + æ™ºèƒ½è¯†åˆ«
- **ä»£ç è´¨é‡é«˜**ï¼šç»“æ„æ¸…æ™°ã€æ˜“ç»´æŠ¤
- **æ‰©å±•æ€§å¥½**ï¼šæ˜“äºæ·»åŠ æ–°åŠŸèƒ½

### ä¸»è¦æ”¹è¿›æ–¹å‘
1. **ç¨³å®šæ€§**ï¼šé”™è¯¯å¤„ç†ã€é‡è¯•æœºåˆ¶
2. **ç”¨æˆ·ä½“éªŒ**ï¼šè¿›åº¦åé¦ˆã€ç»“æœé¢„è§ˆ
3. **æ€§èƒ½**ï¼šç¼“å­˜ã€å¤§æ•°æ®é‡ä¼˜åŒ–
4. **è´¨é‡**ï¼šç¿»è¯‘è´¨é‡æ£€æŸ¥ã€ä¸€è‡´æ€§ä¿è¯
5. **çµæ´»æ€§**ï¼šå¯é…ç½®ã€å¤šæ ¼å¼æ”¯æŒ

å½“å‰ç‰ˆæœ¬å·²ç»æ˜¯ä¸€ä¸ª**åŠŸèƒ½å®Œæ•´ã€æ€§èƒ½ä¼˜ç§€**çš„ç¿»è¯‘ç³»ç»Ÿï¼Œé€‚åˆå¤§éƒ¨åˆ†ä½¿ç”¨åœºæ™¯ã€‚å¦‚æœéœ€è¦å¤„ç†**è¶…å¤§æ•°æ®é‡**æˆ–**ç‰¹æ®Šéœ€æ±‚**ï¼Œå¯ä»¥æ ¹æ®ä¸Šè¿°å»ºè®®è¿›è¡Œé’ˆå¯¹æ€§ä¼˜åŒ–ã€‚
